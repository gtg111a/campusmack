<section id="services_manage" class="services">

  <h2>Authentication Services - Settings</h2>
  <% if @services.any? %>
      <h3>You can use these accounts to sign in</h3>
  <% end %>

  <% @services.each do |service| %>
      <div class="service_in_use round">
        <div class="service_img">
          <% if ['aol', 'facebook', 'github', 'google', 'openid', 'twitter', 'yahoo'].index(service.provider) %>
              <%= image_tag "#{service.provider}_64.png", :size => "64x64" %>
          <% else %>
              <%= image_tag "openid_64.png", :size => "64x64" %>
          <% end %>
        </div>

        <div class="service_userdata">
          <% if service.uid.starts_with?('http') %>
              <%= service.uid.scan(/http[s]*:\/\/.*?\//)[0] %>
          <% else %>
              <%= service.provider.capitalize %>: <%= service.uid %>
          <% end %>
          <br/>
          <% if service.user %>
          <%= service.user %>
          <br/>
          <%= service.user.email %>
          <br/>
          <% end %>
          <% if session[:provider] == service.id %>
              <span>Signed in</span>
          <% else %>
              <%= link_to "Remove this service", service, :confirm => 'Are you sure you want to remove this authentication?', :method => :delete, :class => "remove" %>
          <% end %>
        </div>
      </div>
  <% end %>


  <div id="services_available">
    <h3>You can connect more accounts to sign in</h3>

    <ul id="services_list">
      <%- @available_services.each do |provider| %>
          <li><%= service_link(provider) %></li>
          <% end %>
    </ul>
  </div>
  <br style="clear:both" />
</section>